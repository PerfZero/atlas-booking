
## Базовый URL

```
https://booking.atlas.kz/wp-json/atlas/v1/kaspi
```

## Основные принципы работы интерфейса

1. Каждый платеж в системе имеет уникальный идентификатор `txn_id` – ID запроса (целое число длиной до 18 знаков)

2. В запросе передается дата платежа `txn_date` в формате ГГГГММДДЧЧММСС

3. Идентификация заказа происходит по уникальному номеру, передаваемому в параметре `account`

4. Передача информации о платеже выполняется в 2 этапа:
   - Проверка состояния заказа (`command=check`)
   - Проведение платежа (`command=pay`)

5. Сумма платежа передается в тенге в переменной `sum` – дробное число с точностью до сотых

## Эндпоинты API

### 1. Проверка состояния заказа (Check)

**Метод:** GET  
**Эндпоинт:** `/payment_app.cgi`

#### Параметры запроса:

| Параметр | Описание |
|----------|----------|
| command | Всегда `check` для проверки |
| txn_id | Уникальный идентификатор транзакции (до 18 цифр) |
| account | Номер заказа в системе Atlas Booking |
| sum | Сумма платежа (в запросе check является фиктивной) |

#### Пример запроса:

```
https://booking.atlas.kz/wp-json/atlas/v1/kaspi/payment_app.cgi?command=check&txn_id=1234567&account=ATLAS-2025-001&sum=200.00
```

#### Пример ответа (формат JSON):

```json
{
  "txn_id": "1234567",
  "result": 0,
  "comment": "Заказ найден и доступен для оплаты"
}
```

### 2. Проведение платежа (Pay)

**Метод:** GET  
**Эндпоинт:** `/payment_app.cgi`

#### Параметры запроса:

| Параметр | Описание |
|----------|----------|
| command | Всегда `pay` для проведения платежа |
| txn_id | Уникальный идентификатор транзакции (до 18 цифр) |
| txn_date | Дата транзакции в формате ГГГГММДДЧЧММСС |
| account | Номер заказа в системе Atlas Booking |
| sum | Сумма платежа (дробное число с точностью до сотых) |

#### Пример запроса:

```
https://booking.atlas.kz/wp-json/atlas/v1/kaspi/payment_app.cgi?command=pay&txn_id=1234567&txn_date=20250415120005&account=ATLAS-2025-001&sum=150000.00
```

#### Пример ответа (формат JSON):

```json
{
  "txn_id": "1234567",
  "prv_txn_id": "ATLAS-PAYMENT-12345",
  "result": 0,
  "sum": 150000.00,
  "comment": "Платеж успешно обработан"
}
```

## Коды ошибок

| Код результата | Описание |
|----------------|----------|
| 0 | Заказ найден и доступен для оплаты / Платеж успешно обработан |
| 1 | Заказ не найден |
| 2 | Заказ отменен |
| 3 | Заказ уже оплачен |
| 4 | Платеж в обработке |
| 5 | Другая ошибка провайдера |

## Тестовые номера заказов

Для тестирования интеграции используйте следующие тестовые номера заказов:

| Номер заказа | Описание / Сценарий |
|--------------|---------------------|
| ATLAS-TEST-00001 | Успешная оплата |
| ATLAS-TEST-00002 | Заказ не найден (вернет код 1) |
| ATLAS-TEST-00003 | Заказ отменен (вернет код 2) |
| ATLAS-TEST-00004 | Заказ уже оплачен (вернет код 3) |
| ATLAS-TEST-00005 | Платеж в обработке (вернет код 4) |
| ATLAS-TEST-00006 | Системная ошибка (вернет код 5) |
| ATLAS-TEST-00007 | Тестовый заказ с минимальной суммой (1000 тенге) |
| ATLAS-TEST-00008 | Тестовый заказ с максимальной суммой (5000000 тенге) |
| ATLAS-TEST-00009 | Тестовый заказ для проверки задержки ответа |

## Дополнительные поля в ответе

При необходимости, дополнительную информацию о платеже можно передать через поле `fields`. Пример ответа:

```json
{
  "txn_id": "1234567",
  "result": 0,
  "comment": "Заказ найден",
  "fields": {
    "field1": {
      "@name": "customerName",
      "#text": "Иван Иванов"
    },
    "field2": {
      "@name": "tourName",
      "#text": "Тур в Турцию"
    },
    "field3": {
      "@name": "departureDate",
      "#text": "2025-05-20"
    }
  }
}
```


